function drawFPS() {
    // delta = Date.now() - lastCalledTime, fps_count++, delta > 1e3 && (delta = (Date.now() - lastCalledTime) / 1e3, lastCalledTime = Date.now(), fps = fps_count, fps_count = 0), ctx.save(), ctx.globalCompositeOperation = "source-over", ctx.fillStyle = "white", ctx.fillText("FPS: " + fps, 20, 40), ctx.restore()
}


function drawDecemberCafe() {
    // ctx.fillStyle = "white", ctx.fillText("Designed by DecemberCafe", 20, 20)
}


function updateWindow() {
    w = window;
    d = document;
    e = d.documentElement;
    g = d.getElementsByTagName("body")[0];
    x = e.clientWidth || w.innerWidth || g.clientWidth;

    y = e.clientHeight || w.innerHeight || g.clientHeight;

    width = x < 800 ? 800 : x;
    // height = .7 * y;

    height = y;

    canvas.setAttribute("width", width), canvas.setAttribute("height", height);
}


var canvas = document.getElementById("mycanvas"),
    ctx = canvas.getContext("2d"),
    width = 1600,
    height = 768;


updateWindow();


var backimg = new Image;
backimg.src = "./img/TiffanyTwist.jpg";
var lastCalledTime = Date.now(),
    fps = 100,
    delta = 0,
    fps_count = 0,
    time = 0,
    fireworks = [];


console.log("亲爱的小米：这是第二个提示！'Necklace' (够直接的了吧～，这条提示)");
console.log("我爱你，米思妤！让咱们和和美美，平平安安，高高兴兴的一直走下去！");

setInterval(function() {

    ctx.save();
    ctx.globalAlpha = .2;
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, width, height);
    // ctx.drawImage(backimg, 0, 0, 1600, 1067, 0, 0, width, height);
    ctx.drawImage(backimg,0, 0, width, height);

    ctx.restore();
    ctx.save();
    ctx.globalCompositeOperation = "lighter";

    Math.random() < .1 && fireworks.length < 50 && (fireworks.push(new Firework(ctx, width, height)), fireworks[fireworks.length - 1].init({
        x: 50 + Math.random() * (width - 50),
        y: 90 + 100 * Math.random()
    }, {
        h: Math.random(),
        s: 1,
        l: .6 + .3 * Math.random()
    }, 1500 + 1e3 * Math.random(), parseInt(15 + 10 * Math.random()), 4 + 5 * Math.random()), fireworks[fireworks.length - 1].size = 4 + 3 * Math.random());



    for (var a = fireworks.length - 1; a >= 0; a--){
        fireworks[a].time < fireworks[a].duration ? (fireworks[a].update(), fireworks[a].render()) : fireworks.splice(a, 1);
    }




    ctx.fillStyle = "white";
    ctx.textAlign="center";
    ctx.font="15px Georgia";
    ctx.fillText("致我爱的小米: 生日快乐！我为你精心准备的秘密礼物，在网页中去探索吧！(三个提示)", width/2, height-20);


    // ctx.text("Hello World");

    ctx.font="30px Verdana";
    // Create gradient
    var gradient=ctx.createLinearGradient(0, 0, width, 0);
    gradient.addColorStop("0","magenta");
    gradient.addColorStop("0.5","blue");
    gradient.addColorStop("1.0","red");
    // Fill with gradient
    // "textAlign=center",
    ctx.fillStyle=gradient;
    ctx.fillStyle=gradient;
    ctx.fillText("Happy Birthday", width/2, height/2);
    ctx.fillText("Mi Siyu", width/2, height/2 + 50);


    // ctx.fillStyle = "white";
    // ctx.fillText("Happy Birthday", width/2, height/2);

    ctx.restore();

    // drawDecemberCafe();
    // drawFPS();

}, 33);

window.onresize = updateWindow;
